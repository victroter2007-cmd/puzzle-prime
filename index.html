<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Regalo Congelado</title>

<style>
body {
  margin: 0;
  background: linear-gradient(#0b3d91, #021f4b);
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  color: white;
  text-align: center;
}

h2 { margin: 12px 0 4px; }
p { margin: 0 0 10px; }

#container {
  position: relative;
  width: 320px;
  height: 320px;
  margin: 0 auto;
}

canvas {
  position: absolute;
  left: 0;
  top: 0;
  touch-action: none;
  border-radius: 12px;
}

#msg {
  display: none;
  margin-top: 16px;
  font-size: 18px;
}
</style>
</head>

<body>

<h2>â„ï¸ El regalo estÃ¡ congelado</h2>
<p>Rasca la nieve con el dedo ğŸ‘†</p>

<div id="container">
  <!-- Imagen real -->
  <img src="qr.png" width="320" height="320" style="border-radius:12px;">
  <!-- Nieve -->
  <canvas id="snow" width="320" height="320"></canvas>
</div>

<div id="msg">
  ğŸ‰ Â¡Ya se ve!  
  <br>ğŸ“¸ Escanea el QR
</div>

<script>
const canvas = document.getElementById("snow");
const ctx = canvas.getContext("2d");
let scratching = false;

// Dibujar nieve
ctx.fillStyle = "#ffffff";
ctx.fillRect(0, 0, canvas.width, canvas.height);

// Efecto borrador
ctx.globalCompositeOperation = "destination-out";

function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  return {
    x: touch.clientX - rect.left,
    y: touch.clientY - rect.top
  };
}

canvas.addEventListener("touchstart", e => {
  scratching = true;
});

canvas.addEventListener("touchend", e => {
  scratching = false;
  checkClear();
});

canvas.addEventListener("touchmove", e => {
  if (!scratching) return;
  e.preventDefault();
  const pos = getPos(e);
  ctx.beginPath();
  ctx.arc(pos.x, pos.y, 22, 0, Math.PI * 2);
  ctx.fill();
});

function checkClear() {
  const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
  let cleared = 0;
  for (let i = 3; i < data.length; i += 4) {
    if (data[i] === 0) cleared++;
  }
  if (cleared / (canvas.width * canvas.height) > 0.45) {
    document.getElementById("msg").style.display = "block";
  }
}
</script>

</body>
</html>

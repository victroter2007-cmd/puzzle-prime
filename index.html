<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Puzzle del Regalo</title>

<style>
body {
  margin: 0;
  background: linear-gradient(#0b3d91, #021f4b);
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  color: white;
  text-align: center;
}

h2 { margin: 12px 0 4px; }
p { margin: 0 0 10px; }

#board {
  width: 300px;
  height: 300px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 4px;
  touch-action: manipulation;
}

.tile {
  border-radius: 8px;
  background-image: url("qr.png");
  background-size: 300px 300px;
  transition: transform 0.15s ease;
}

.tile:active {
  transform: scale(0.95);
}

.empty {
  background: none;
}

#msg {
  display: none;
  margin-top: 16px;
  font-size: 18px;
}
</style>
</head>

<body>

<h2>üß© Ordena el puzzle</h2>
<p>Completa la imagen para descubrir tu regalo üéÅ</p>

<div id="board"></div>

<div id="msg">
  üéâ ¬°Perfecto!  
  <br>üì∏ Ahora escanea el QR
</div>

<script>
const size = 3;
const board = document.getElementById("board");
let tiles = [];

function isSolved() {
  return tiles.every((v, i) => v === i);
}

function shuffle(arr) {
  do {
    arr.sort(() => Math.random() - 0.5);
  } while (!isSolvable(arr));
}

function isSolvable(arr) {
  let inv = 0;
  for (let i = 0; i < arr.length; i++) {
    for (let j = i + 1; j < arr.length; j++) {
      if (arr[i] && arr[j] && arr[i] > arr[j]) inv++;
    }
  }
  return inv % 2 === 0;
}

function draw() {
  board.innerHTML = "";
  tiles.forEach((n, i) => {
    const d = document.createElement("div");
    d.className = "tile";

    if (n === 0) {
      d.classList.add("empty");
    } else {
      const x = (n - 1) % size;
      const y = Math.floor((n - 1) / size);
      d.style.backgroundPosition = `-${x * 100}px -${y * 100}px`;
      d.onclick = () => move(i);
    }
    board.appendChild(d);
  });
}

function move(i) {
  const empty = tiles.indexOf(0);
  const valid = [
    empty - 1,
    empty + 1,
    empty - size,
    empty + size
  ];

  if (!valid.includes(i)) return;

  [tiles[i], tiles[empty]] = [tiles[empty], tiles[i]];
  draw();

  if (isSolved()) {
    document.getElementById("msg").style.display = "block";
  }
}

function init() {
  tiles = [...Array(size * size).keys()];
  shuffle(tiles);
  draw();
}

init();
</script>

</body>
</html>
